---
title: "Final ML Runs"
output: html_notebook
---

This notebook runs the complete hurdle models for RFMO dataset.

```{r message=FALSE, warning=FALSE, include=FALSE}
# General
library(raster)
library(sf)
library(fasterize)
library(scales)
library(knitr)
library(RColorBrewer)
library(readxl)
library(googledrive)
library(cowplot)
library(tidyverse)
library(sp)
library(rgdal)
library(geosphere)
library(paletteer)

# Neg Binomial Libraries
library(pscl)

# ML Libraries
library(tidymodels)
library(readr)
library(broom.mixed)
library(MultivariateRandomForest)
library(vroom)

options(scipen = 1000000)

# Get functions
source("../functions/func-all_rfmo_initial_models.R")
source("../functions/func-all_rfmo_effort_models.R")
source("../functions/func-train_all_models.R")
source("../functions/func-train_test_split.R")

save_loc = "../../data/model-data/outputs/all-rfmo-models/"
```

```{r include=FALSE}
# Read in data... 
# 5x5 data - count only
count_5x5_obs <- read.csv("../../data/model-data/inputs/all-rfmo-models/global_ll_data_5x5_count_hooks.csv") 
count_5x5_gfw <- read.csv("../../data/model-data/inputs/all-rfmo-models/global_ll_data_5x5_count_kwh.csv") 

# 5x5 data - mt and count
mt_5x5_obs <- read.csv("../../data/model-data/inputs/all-rfmo-models/global_ll_data_5x5_mt_to_count_hooks.csv") 
mt_5x5_gfw <- read.csv("../../data/model-data/inputs/all-rfmo-models/global_ll_data_5x5_mt_to_count_kwh.csv") 

# 1x1 data - count only
count_1x1_obs <- read.csv("../../data/model-data/inputs/all-rfmo-models/global_ll_data_1x1_count_hooks.csv") %>% 
  bind_rows(read.csv("../../data/model-data/inputs/wcpfc-only-model/wcpfc_1x1_hooks.csv"))
count_1x1_gfw <- read.csv("../../data/model-data/inputs/all-rfmo-models/global_ll_data_1x1_count_kwh.csv") %>% 
  bind_rows(read.csv("../../data/model-data/inputs/wcpfc-only-model/wcpfc_1x1_kwh.csv"))

# 1x1 data - mt and count
mt_1x1_obs <- read.csv("../../data/model-data/inputs/all-rfmo-models/global_ll_data_1x1_mt_to_count_hooks.csv")
mt_1x1_gfw <- read.csv("../../data/model-data/inputs/all-rfmo-models/global_ll_data_1x1_mt_to_count_kwh.csv") 
```

```{r}
# Run effort scenarios... 
# 5x5 data - count only
results_5x5_count <- all_rfmo_effort_models(data_gfw = count_5x5_gfw, data_effort = count_5x5_obs, save_loc = paste0(save_loc, "5x5_count_"))

# 5x5 data - mt and count
results_5x5_mt <- all_rfmo_effort_models(data_gfw = mt_5x5_gfw, data_effort = mt_5x5_obs, save_loc = paste0(save_loc, "5x5_mt_to_count_"))

# 1x1 data - count only
results_1x1_count <- all_rfmo_effort_models(data_gfw = count_1x1_gfw, data_effort = count_1x1_obs, save_loc = paste0(save_loc, "1x1_count_"))

# 1x1 data - mt and count
results_1x1_mt <- all_rfmo_effort_models(data_gfw = mt_1x1_gfw, data_effort = mt_1x1_obs, save_loc = paste0(save_loc, "1x1_mt_to_count_"))
```


```{r}
# Find best performing models
all_model_results <- results_5x5_count %>% 
  mutate(option = "5x5, count only") %>% 
  bind_rows(results_5x5_mt %>% 
              mutate(option = "5x5, mt to count")) %>% 
  bind_rows(results_1x1_count %>% 
              mutate(option = "1x1, count only")) %>% 
  bind_rows(results_1x1_mt %>% 
              mutate(option = "1x1, mt to count")) 

all_model_results %>% 
  group_by(rfmo) %>% 
  slice_max(., rsq)
```

```{r}
# The best models 
```

