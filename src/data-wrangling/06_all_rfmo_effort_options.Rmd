---
title: "Spatial Correlation of Effort Datasets"
output:
  pdf_document: default
---

# Description

There are three effort options that we can use in the machine learning model for each RFMO: 

1. Effort reported with bycatch data (by flag if available)
2. Effort reported with target catch data (by flag if available) in the same grid cell and year that bycatch data were reported
3. Effort reported by GFW (kwh) in the same grid cell and year that bycatch data were reported. 

There are also several different resolutions of data for which we can use in the machine learning model for each RFMO: 

1. Catch data reported as count and effort data in the 5x5 degree resolution only (5x5 resolution, count only)
2. Catch data that were reported in metric tonnes were converted to count using weight to count measurements described in Boris et al. 2013 for small coastal, pelagic, large coastal, and deep water species. The sum of all catch data reported as count and effort data in the 5x5 degree resolution only (5x5 resolution, count and mt converted to count)
Catch and effort data that were reported in the 5x5 degree resolution were evenly distributed into 25 cells at a 1x1 degree resolution. Catch and effort reported at the 5x5 degree resolution was divided by 25 for each new 1x1 degree cell (catch/25, effort/25). 
3. Catch data reported as count and effort data were summed at the 1x1 degree resolution (1x1 resolution, count only)
4. Catch and effort data that were reported in the 5x5 degree resolution were evenly distributed into a 1x1 degree resolution (catch/25, effort/25). Catch data that were reported in metric tonnes were converted to count using weight to count measurements described in Boris et al. 2013 for small coastal, pelagic, large coastal, and deep water species. The sum of all catch data reported as count and effort data were summed at the 1x1 degree resolution (1x1 resolution, count and mt converted to count)

# Longline Data Results

To test whether the effort options are spatially correlated, we will plot the each of the total effort by latitude, longitude, gear, and RFMO combination against one another. We will use dataset #3 listed above for WCPFC because catch data was only reported in count. We will use dataset #4 listed above for IATTC, ICCAT, and IOTC, because data was reported in both count and metric tonnes.

```{r include=FALSE}
knitr::opts_chunk$set(
	message = FALSE,
	warning = FALSE,
	echo = FALSE
)
# Libraries
library(tidyverse)

# Load data
# 1x1 data - count only
list_files<- c(list.files("../../data/model-data/inputs/all-rfmo-models/", pattern = "1x1_mt_to_count_hooks.csv", full.names = T), "../../data/model-data/inputs/all-rfmo-models/WCPFC_ll_data_1x1_count_hooks.csv")

count_1x1_obs <- NULL 

for(file in list_files) {
  temp <- read.csv(file)
  count_1x1_obs <- bind_rows(count_1x1_obs, temp)
} 

list_files <- c(list.files("../../data/model-data/inputs/all-rfmo-models/", pattern = "1x1_mt_to_count_kwh.csv", full.names = T), 
                "../../data/model-data/inputs/all-rfmo-models/WCPFC_ll_data_1x1_count_kwh.csv")

count_1x1_gfw <- NULL

for(file in list_files) {
  temp <- read.csv(file)
  count_1x1_gfw <- bind_rows(count_1x1_gfw, temp)
} 
```

```{r}
gfw_total <- count_1x1_gfw %>% 
  select(year, rfmo, latitude, longitude, total_fishing_kwh) %>% 
  distinct_all() %>% 
  filter(!is.na(total_fishing_kwh))

target_reported_total <- count_1x1_obs %>% 
  select(year, rfmo, latitude, longitude, target_effort) %>% 
  distinct_all() %>% 
  filter(!is.na(target_effort)) 

bycatch_reported_total <- count_1x1_obs %>% 
  select(year, rfmo, latitude, longitude, bycatch_total_effort) %>% 
  distinct_all() %>% 
  filter(!is.na(bycatch_total_effort))

all_effort <- full_join(gfw_total, target_reported_total) %>% 
  full_join(., bycatch_reported_total)
```


## GFW Effort vs Effort Reported with Target Catch

```{r}
ggplot(data = all_effort, aes(x = total_fishing_kwh, 
                              y = target_effort)) + 
  geom_point(color = "black", alpha = 0.2, position = position_jitter()) + 
  facet_wrap(vars(rfmo), scales = "free") +
  geom_smooth(method='lm', formula= y~x, color = "blue", lty = 2) + 
  theme_minimal() + 
  scale_y_continuous(name = "Total Effort Reported with Target Catch (hooks)", labels = scales::label_comma()) +
  scale_x_continuous(name = "Total GFW Effort (kwh)", labels = scales::label_comma()) + 
  theme(axis.text.x = element_text(angle = 20))
```


## GFW Effort vs Effort Reported with Byatch

```{r}
ggplot(data = all_effort, aes(x = total_fishing_kwh, 
                              y = bycatch_total_effort)) + 
  geom_point(color = "black", alpha = 0.2, position = position_jitter()) + 
  facet_wrap(vars(rfmo), scales = "free") +
  geom_smooth(method='lm', formula= y~x, color = "blue", lty = 2) + 
  theme_minimal() + 
  scale_y_continuous(name = "Total Effort Reported with Byatch (hooks)", labels = scales::label_comma()) +
  scale_x_continuous(name = "Total GFW Effort (kwh)", labels = scales::label_comma()) + 
  theme(axis.text.x = element_text(angle = 20))
```


## Effort Reported with Target Catch vs Effort Reported with Byatch

```{r}
ggplot(data = all_effort, aes(x = target_effort, 
                              y = bycatch_total_effort)) + 
  geom_point(color = "black", alpha = 0.2, position = position_jitter()) + 
  facet_wrap(vars(rfmo), scales = "free") +
  geom_smooth(method='lm', formula= y~x, color = "blue", lty = 2) + 
  theme_minimal() + 
  scale_y_continuous(name = "Total Effort Reported with Byatch (hooks)", labels = scales::label_comma()) +
  scale_x_continuous(name = "Total Effort Reported with Target Catch (hooks)", labels = scales::label_comma()) + 
  theme(axis.text.x = element_text(angle = 20))
```


# Purse Seine Data Results

To test whether the effort options are spatially correlated, we will plot the each of the total effort by latitude, longitude, gear, and RFMO combination against one another. We will use dataset #3 listed above for WCPFC because catch data was only reported in count. We will use dataset #4 listed above for IATTC because data was reported in both count and metric tonnes. For effort reported with bycatch data or target catch data, we used only effort units that matched the most common effort unit associated with bycatch. For example, if most bycatch data for an RFMO were caught in "sets", we only used effort data associated with "sets". IOTC was not included in this analysis because effort reported with target catch or bycatch could not be associated to an effort unit. ICCAT was not included in this analysis because there was no spatiotemporal overlap between GFW effort and effort reported with target catch or bycatch.

```{r}
# Open location
open_loc = "~/Google Drive/Shared drives/emlab/projects/current-projects/finmap/data/r-model/inputs"

# Load data
# 1x1 data - count only
list_files<- c(paste0(open_loc, "/IATTC_ps_data_1x1_mt_to_count_sets.csv"), 
               paste0(open_loc, "/WCPFC_ps_data_1x1_count_sets.csv"))

count_1x1_obs <- NULL 

for(file in list_files) {
  temp <- read.csv(file)
  count_1x1_obs <- bind_rows(count_1x1_obs, temp)
} 

list_files<- c(paste0(open_loc, "/IATTC_ps_data_1x1_mt_to_count_kwh.csv"), 
               paste0(open_loc, "/WCPFC_ps_data_1x1_count_kwh.csv"))

count_1x1_gfw <- NULL

for(file in list_files) {
  temp <- read.csv(file)
  count_1x1_gfw <- bind_rows(count_1x1_gfw, temp)
} 
```

```{r}
gfw_total <- count_1x1_gfw %>% 
  select(year, rfmo, latitude, longitude, total_fishing_kwh) %>% 
  distinct_all() %>% 
  filter(!is.na(total_fishing_kwh))

target_reported_total <- count_1x1_obs %>% 
  mutate(rfmo_name = paste0(rfmo, " (",effort_units, ")")) %>%
  select(year, rfmo, rfmo_name, latitude, longitude, target_effort) %>% 
  distinct_all() %>% 
  filter(!is.na(target_effort)) 

bycatch_reported_total <- count_1x1_obs %>% 
  mutate(rfmo_name = paste0(rfmo, " (",effort_units, ")")) %>%
  select(year, rfmo, rfmo_name, latitude, longitude, bycatch_total_effort) %>% 
  distinct_all() %>% 
  filter(!is.na(bycatch_total_effort))

all_effort <- full_join(gfw_total, target_reported_total) %>% 
  full_join(., bycatch_reported_total)
```


## GFW Effort vs Effort Reported with Target Catch

```{r}
ggplot(data = all_effort, aes(x = total_fishing_kwh, 
                              y = target_effort)) + 
  geom_point(color = "black", alpha = 0.2, position = position_jitter()) + 
  facet_wrap(vars(rfmo_name), scales = "free") +
  geom_smooth(method='lm', formula= y~x, color = "blue", lty = 2) + 
  theme_minimal() + 
  scale_y_continuous(name = "Total Effort Reported with Target Catch (hooks)", labels = scales::label_comma()) +
  scale_x_continuous(name = "Total GFW Effort (kwh)", labels = scales::label_comma()) + 
  theme(axis.text.x = element_text(angle = 20))
```


## GFW Effort vs Effort Reported with Byatch

```{r}
ggplot(data = all_effort, aes(x = total_fishing_kwh, 
                              y = bycatch_total_effort)) + 
  geom_point(color = "black", alpha = 0.2, position = position_jitter()) + 
  facet_wrap(vars(rfmo_name), scales = "free") +
  geom_smooth(method='lm', formula= y~x, color = "blue", lty = 2) + 
  theme_minimal() + 
  scale_y_continuous(name = "Total Effort Reported with Byatch (hooks)", labels = scales::label_comma()) +
  scale_x_continuous(name = "Total GFW Effort (kwh)", labels = scales::label_comma()) + 
  theme(axis.text.x = element_text(angle = 20))
```


## Effort Reported with Target Catch vs Effort Reported with Byatch

```{r}
ggplot(data = all_effort, aes(x = target_effort, 
                              y = bycatch_total_effort)) + 
  geom_point(color = "black", alpha = 0.2, position = position_jitter()) + 
  facet_wrap(vars(rfmo), scales = "free") +
  geom_smooth(method='lm', formula= y~x, color = "blue", lty = 2) + 
  theme_minimal() + 
  scale_y_continuous(name = "Total Effort Reported with Byatch (hooks)", labels = scales::label_comma()) +
  scale_x_continuous(name = "Total Effort Reported with Target Catch (hooks)", labels = scales::label_comma()) + 
  theme(axis.text.x = element_text(angle = 20))
```
